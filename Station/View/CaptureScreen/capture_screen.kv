<CaptureScreen>:
    md_bg_color: 1, 1, 1, 1  # White background

    MDBoxLayout:
        orientation: 'vertical'
        padding: "20dp"
        spacing: "20dp"

        # -- Logo Area Placeholder --
        Widget:
            size_hint_y: 0.3

        MDLabel:
            text: "Place tool on Bed"
            halign: "center"
            font_style: "H4"
            size_hint_y: 0.1

        # --- CAMERA CONTAINER ---
        MDRelativeLayout:
            size_hint_y: 0.7

            # 1. The Camera Feed
            Image:
                id: camera_preview
                source: "assets/images/logo_white.png"
                allow_stretch: True
                keep_ratio: True
                opacity: 0 

            # 2. Processing Overlay (Spinner + Text)
            MDBoxLayout:
                id: processing_overlay
                orientation: 'vertical'
                adaptive_size: True
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                spacing: "15dp"

                # Hidden by default (opacity 0)
                opacity: 0

                MDSpinner:
                    id: loading_spinner
                    size_hint: None, None
                    size: "60dp", "60dp"
                    pos_hint: {'center_x': .5}
                    active: False
                    palette: [ [0.2, 0.6, 0.8, 1] ]

                MDLabel:
                    id: loading_label
                    text: "Initializing..."
                    halign: "center"
                    theme_text_color: "Custom"
                    text_color: 0.2, 0.6, 0.8, 1 # Match Spinner Blue
                    font_style: "H5"
                    bold: True

        MDBoxLayout:
            orientation: 'horizontal'
            spacing: "20dp"             # Gap between buttons
            size_hint_y: None           # Don't expand vertically
            height: '80dp'              # Fixed height for this row
            pos_hint: {"centre_x": .5}
            padding: '10dp'             # Optional padding around the row

            MDFillRoundFlatButton:
                text: "DEV - BACK\n(Action Selection\nScreen)"
                font_size: "14sp"
                size_hint: .2, 1        
                md_bg_color: 0.4, 0.4, 0.4, 1  # Grey
                on_release: root.go_back('action selection screen')
            
            MDFillRoundFlatButton:
                text: "DEV - Capture"
                font_size: "14sp"
                size_hint: .2, 1        
                md_bg_color: 0.4, 0.4, 0.4, 1  # Grey
                on_release: root.capture_btn('done')

            # -- DEV BUTTON --
            MDFillRoundFlatButton:
                text: "DEV - NEXT\n(Tool Confirm\nScreen)"
                font_size: "14sp"
                size_hint: .2, 1        
                md_bg_color: 0.4, 0.4, 0.4, 1  # Grey
                on_release: root.go_to('tool confirm screen')

        # -- Cancel Button --
        MDFillRoundFlatButton:
            text: "CANCEL"
            font_size: "24sp"
            size_hint: 1, 0.01
            pos_hint: {"center_x": .5}
            md_bg_color: 0.9, 0.17, 0.25, 1  # Red
            on_release: root.cancel_transaction()

        # Widget:
        #     size_hint_y: 0.01